# GENERATED BY NETBOX
# Changes will be overwritten

{% set manageable_devices = queryset
    .filter(device_role__slug__in=['ar', 'cr', 'crs', 'drs', 'oob'])
    .exclude(site__slug__in=['labdro3'])
    .exclude(primary_ip4=None, primary_ip6=None)
    .order_by('site__slug', 'name')
-%}
{% set manageable_device_names = manageable_devices.values_list('name', flat=True) -%}
{% set member_devices = manageable_devices
    .values_list('virtual_chassis__members__name', flat=True)
    .order_by('virtual_chassis__members__name')
-%}

# Grouping by platform
{% for group, devices in manageable_devices | selectattr('platform') | groupby('platform.slug') -%}
[{{ group | replace('-', '_') }}]
{% for device in devices -%}
{{ device.name }}
{% endfor %}
{% endfor %}

# Grouping by device type
{% for group, devices in manageable_devices | selectattr('device_type') | groupby('device_type.manufacturer.slug') -%}
{% for subgroup, subdevices in devices | groupby('device_type.slug') -%}
[{{ group | replace('-', '_') }}_{{ subgroup | replace('-', '_') }}]
{% for device in subdevices -%}
{{ device.name }}
{% endfor %}
{% endfor %}{% endfor %}

# Grouping by site
{% for group, devices in manageable_devices | selectattr('site') | groupby('site.slug') -%}
[{{ group | replace('-', '_') }}]
{% for device in devices -%}
{{ device.name }}
{% endfor %}
{% endfor %}

# Grouping by device role
{% for group, devices in manageable_devices | selectattr('device_role') | groupby('device_role.slug') -%}
[{{ group | replace('-', '_') }}]
{% for device in devices -%}
{{ device.name }}
{% endfor %}
{% endfor %}

# All devices without a management address
[unmanaged]
{% for device_name in member_devices if device_name and device_name not in manageable_device_names -%}
{{ device_name }}
{% endfor %}
